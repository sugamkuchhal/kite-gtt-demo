#!/usr/bin/env bash
set -euo pipefail

SCRIPT_NAME="${1:-}"
if [ -z "$SCRIPT_NAME" ]; then
  echo "Usage: run_py <script> [args...]" >&2
  exit 2
fi
shift || true

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

ROOT_SCRIPT="${REPO_ROOT}/${SCRIPT_NAME}.py"
EXTRA_SCRIPT="${REPO_ROOT}/extra/${SCRIPT_NAME}.py"
VENV_PY="${REPO_ROOT}/.venv/bin/python"
PYTHON_BIN="python3"
if [ -x "$VENV_PY" ]; then
  PYTHON_BIN="$VENV_PY"
fi

if [ -f "$ROOT_SCRIPT" ]; then
  exec "$PYTHON_BIN" -u "$ROOT_SCRIPT" "$@"
fi

if [ -f "$EXTRA_SCRIPT" ]; then
  exec "$PYTHON_BIN" -u "$EXTRA_SCRIPT" "$@"
fi

echo "Unknown script: ${SCRIPT_NAME}" >&2
exit 2
